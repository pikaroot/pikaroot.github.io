---
title: "One Page [Code Audit]"
categories: Acs2023
permalink: /ctfs/acs2023/onepage
---
PHP Remote Code Execution.

## ðŸ“ Challenge Description

> Create your own webpage.
>
> `http://192.168.0.52:40081`

```
$ tree
.
â””â”€â”€ challenge
 Â Â  â”œâ”€â”€ docker-compose.yml
 Â Â  â””â”€â”€ service
 Â Â      â”œâ”€â”€ Dockerfile
 Â Â      â”œâ”€â”€ app
 Â Â      â”‚Â Â  â”œâ”€â”€ application
 Â Â      â”‚Â Â  â”‚Â Â  â”œâ”€â”€ controllers
 Â Â      â”‚Â Â  â”‚Â Â  â”‚Â Â  â”œâ”€â”€ errorController.php
 Â Â      â”‚Â Â  â”‚Â Â  â”‚Â Â  â”œâ”€â”€ indexController.php
 Â Â      â”‚Â Â  â”‚Â Â  â”‚Â Â  â”œâ”€â”€ pageController.php
 Â Â      â”‚Â Â  â”‚Â Â  â”‚Â Â  â””â”€â”€ userController.php
 Â Â      â”‚Â Â  â”‚Â Â  â”œâ”€â”€ core
 Â Â      â”‚Â Â  â”‚Â Â  â”‚Â Â  â”œâ”€â”€ bootstrap.php
 Â Â      â”‚Â Â  â”‚Â Â  â”‚Â Â  â””â”€â”€ core.php
 Â Â      â”‚Â Â  â”‚Â Â  â”œâ”€â”€ models
 Â Â      â”‚Â Â  â”‚Â Â  â”‚Â Â  â”œâ”€â”€ fileModel.php
 Â Â      â”‚Â Â  â”‚Â Â  â”‚Â Â  â””â”€â”€ userModel.php
 Â Â      â”‚Â Â  â”‚Â Â  â”œâ”€â”€ utils
 Â Â      â”‚Â Â  â”‚Â Â  â”‚Â Â  â”œâ”€â”€ template.php
 Â Â      â”‚Â Â  â”‚Â Â  â”‚Â Â  â””â”€â”€ util.php
 Â Â      â”‚Â Â  â”‚Â Â  â””â”€â”€ views
 Â Â      â”‚Â Â  â”‚Â Â      â”œâ”€â”€ index.tpl
 Â Â      â”‚Â Â  â”‚Â Â      â”œâ”€â”€ login.tpl
 Â Â      â”‚Â Â  â”‚Â Â      â”œâ”€â”€ page.tpl
 Â Â      â”‚Â Â  â”‚Â Â      â”œâ”€â”€ register.tpl
 Â Â      â”‚Â Â  â”‚Â Â      â””â”€â”€ textarea.tpl
 Â Â      â”‚Â Â  â”œâ”€â”€ index.php
 Â Â      â”‚Â Â  â”œâ”€â”€ public
 Â Â      â”‚Â Â  â”‚Â Â  â”œâ”€â”€ sample.css
 Â Â      â”‚Â Â  â”‚Â Â  â”œâ”€â”€ sample.html
 Â Â      â”‚Â Â  â”‚Â Â  â””â”€â”€ sample.js
 Â Â      â”‚Â Â  â””â”€â”€ user
 Â Â      â””â”€â”€ flag.txt
```

## ðŸš© Solution

![image](https://github.com/pikaroot/pikaroot.github.io/assets/107750005/37ab43ca-c905-48a9-ad4a-7a0b70892e0a)

```php
<?php

namespace Controllers;

class PageController {

    private $file;
    private $userData;
    private $util;
    public function __construct() {

        $this->util = new \utils\util();
        $this->file = new \models\fileModel();
        $this->userData = $_SESSION['userData'];
        if(!isset($this->userData)) $this->util->alertExit("Login Plz");
    }

    public function samplePage() {

        $this->file->copyFile(ROOT . 'public/sample.html', ROOT . 'user/' . $this->userData['uuid'] . '/' . $this->userData['uuid'] . '.html');
        $this->file->copyFile(ROOT . 'public/sample.js', ROOT . 'user/' . $this->userData['uuid'] . '/' . $this->userData['uuid'] . '.js');
        $this->file->copyFile(ROOT . 'public/sample.css', ROOT . 'user/' . $this->userData['uuid'] . '/' . $this->userData['uuid'] . '.css');
        $this->util->alertExit("Create Success");

    }

    public function viewPage() {

        $tpl = new \utils\template(VIEW . 'page.tpl');
        $tpl->render([
            "script" => './user/' . $this->userData['uuid'] . '/' . $this->userData['uuid'] . '.js',
            "css" => './user/' . $this->userData['uuid'] . '/' . $this->userData['uuid'] . '.css',
            "html" => $this->file->getFile(ROOT . 'user/' . $this->userData['uuid'] . '/' . $this->userData['uuid'] . '.html')
        ]);

    }

    public function edit() {

        if(!in_array($_REQUEST['type'], ['html', 'js', 'css'])) $this->util->alertExit("Invalid type");

        if($_SERVER['REQUEST_METHOD'] == 'POST'){

            $this->file->createFile(ROOT . 'user/' . $this->userData['uuid'] . '/' . $this->userData['uuid'] . '.' . $_POST['type'], $_POST['data']);
            $this->util->alertExit("Edit Success");
        }

        $tpl = new \utils\template(VIEW . 'textarea.tpl');
        $tpl->render(["type" => $_GET['type'], "data" => $this->file->getFile(ROOT . 'user/' . $this->userData['uuid'] . '/' . $this->userData['uuid'] . '.' . $_GET['type'])]);

    }

}
```


```php
public function viewPage() {

    $tpl = new \utils\template(VIEW . 'page.tpl');
    $tpl->render([
        "script" => './user/' . $this->userData['uuid'] . '/' . $this->userData['uuid'] . '.js',
        "css" => './user/' . $this->userData['uuid'] . '/' . $this->userData['uuid'] . '.css',
        "html" => $this->file->getFile(ROOT . 'user/' . $this->userData['uuid'] . '/' . $this->userData['uuid'] . '.html')
    ]);

}
```

```php
public function edit() {

    if(!in_array($_REQUEST['type'], ['html', 'js', 'css'])) $this->util->alertExit("Invalid type");

    if($_SERVER['REQUEST_METHOD'] == 'POST'){

        $this->file->createFile(ROOT . 'user/' . $this->userData['uuid'] . '/' . $this->userData['uuid'] . '.' . $_POST['type'], $_POST['data']);
        $this->util->alertExit("Edit Success");
    }

    $tpl = new \utils\template(VIEW . 'textarea.tpl');
    $tpl->render(["type" => $_GET['type'], "data" => $this->file->getFile(ROOT . 'user/' . $this->userData['uuid'] . '/' . $this->userData['uuid'] . '.' . $_GET['type'])]);

}
```

![image](https://github.com/pikaroot/pikaroot.github.io/assets/107750005/9a3fb65f-5d01-46b8-8e82-93c8d314ccfe)

![image](https://github.com/pikaroot/pikaroot.github.io/assets/107750005/cbe4ba03-ba7e-40ef-ab14-77a2d0db3f89)

![image](https://github.com/pikaroot/pikaroot.github.io/assets/107750005/5f958f07-2729-4e36-9b8e-e3b2e163d612)

![image](https://github.com/pikaroot/pikaroot.github.io/assets/107750005/dccc3581-ca92-4ce4-81a4-9eca8fd0cf52)

![image](https://github.com/pikaroot/pikaroot.github.io/assets/107750005/94624a88-4fc3-4e06-b813-59aa8f2a4b4c)

![image](https://github.com/pikaroot/pikaroot.github.io/assets/107750005/44d11f3a-2ba5-416a-b9c4-62c6640a5dd9)


**FLAG**: `ACS{b5932a3742f164d061f67996e41097c9}`
